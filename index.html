<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <style>
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f1f3f6;
      box-sizing: border-box;
    }
input[name="date"] {
  width: 80px;
}

input[name="province"] {
  width: 120px;
}
input[name="unit"]       { width: 200px; }
input[name="purpose"]    { width: 180px; }
input[name="distance"]   { width: 80px;  text-align: right; }
input[name="travel"]     { width: 80px; text-align: right; }
input[name="stay"]       { width: 50px; text-align: right; }
input[name="daily"]      { width: 50px; text-align: right; }
input[name="entertain"]  { width: 80px; text-align: right; }
input[name="repair"]     { width: 80px; text-align: right; }
input[name="other"]      { width: 80px; text-align: right; }
input[name="note"]       { width: 150px; }
    #advanceInput {
      width: 100px;
      text-align: right !important;
      background: white !important;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border-radius: 8px;
    }

    th, td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid #ddd;
      vertical-align: middle;
      font-size: 13px;
    }

    th {
      background: #1976d2;
      color: white;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 6px;
      box-sizing: border-box;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 13px;
    }

    input:read-only {
      background: #eee;
    }

    button {
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      margin: 4px 6px 10px 0;
    }

    .totals {
      background: #e3f2fd;
      font-weight: bold;
      color: #0d47a1;
      text-align: center;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    @media print {
      @page {
        size: landscape;
        margin: 10mm;
      }
      input, select {
  text-align: right;
}

    }
  </style>
</head>

<datalist id="provinceList"></datalist>
<script>
  fetch("https://raw.githubusercontent.com/kongvut/thai-province-data/master/api_province.json")
    .then(res => res.json())
    .then(data => {
      const provinceList = document.getElementById("provinceList");
      data.forEach(province => {
        const opt = document.createElement("option");
        opt.value = province.name_th;
        provinceList.appendChild(opt);
      });
    })
    .catch(err => {
      console.error("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å API ‡πÑ‡∏î‡πâ:", err);
    });
</script>



<style>
  /* ...‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°... */
  tbody tr:nth-child(odd) {
    background-color: #f9f9f9;
  }
  tbody tr:nth-child(even) {
    background-color: #dad9f0;
  }
</style>
<body>


<h2 style="text-align:center; color:#1976d2; margin-bottom: 20px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h2>
<!-- üßæ Header ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å -->
<div id="headerInfo" style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px;">
  <input type="text" id="userName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" style="flex: 1; min-width: 200px;">
  <input type="text" id="userPosition" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" style="flex: 1; min-width: 200px;">
  <div style="display: flex; align-items: center; gap: 6px; flex: 1; min-width: 300px;">
    <label for="fromDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
    <input type="text" id="fromDate" style="flex: 1;" placeholder="‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ">
    <span>‡∏ñ‡∏∂‡∏á</span>
    <input type="text" id="toDate" style="flex: 1;" placeholder="‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ">
  </div>
</div>


<table id="expenseTable">
  <thead>
    <tr>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
      <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
      <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
      <th>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</th>
      <th>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á</th>
      <th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</th>
      <th>‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</th>
      <th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</th>
      <th>‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</th>
      <th>‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ã‡πà‡∏≠‡∏°</th>
      <th>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</th>
      <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
      <th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody id="expenseBody"></tbody>
  <tfoot>
  <tr class="totals">
    <td colspan="4">‡∏£‡∏ß‡∏°</td>
    <td id="sumDistance">0.00 ‡∏Å‡∏°.</td>
    <td id="sumTravel">0.00 ‡∏ö‡∏≤‡∏ó</td>
    <td id="sumStay">0.00 ‡∏ö‡∏≤‡∏ó</td>
    <td id="sumDaily">0.00 ‡∏ö‡∏≤‡∏ó</td>
    <td id="sumEntertain">0.00 ‡∏ö‡∏≤‡∏ó</td>
    <td id="sumRepair">0.00 ‡∏ö‡∏≤‡∏ó</td>
    <td id="sumOther">0.00 ‡∏ö‡∏≤‡∏ó</td>
    <td colspan="2"></td>
  </tr>
</tfoot>
</table>
<div style="margin-top: 20px;">
  <button onclick="addRow()" style="width: 180px;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß</button>
</div>

<div class="summary" style="display: flex; justify-content: flex-end; gap: 20px; margin-top: 15px; align-items: center;">
  <label style="display: flex; align-items: center; gap: 6px;">
    ADVANCE:
    <input type="text" id="advanceInput" value="0" oninput="this.value = this.value.replace(/[^\d.]/g, '')" onfocus="this.select()" onblur="this.value = formatNumber(this.value); updateSummary()">
  </label>
  <div style="white-space: nowrap;">
    <span id="netTotal">‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°: 0.00 ‡∏ö‡∏≤‡∏ó</span>
  </div>
</div>

<div class="controls" style="align-items: flex-end; margin-top: 15px;">
  <input type="text" id="saveName" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" style="width: 200px;">
  <button onclick="saveLocalNamed()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <select id="savedList" style="width: 180px;"></select>
  <button onclick="loadLocalNamed()">üìÇ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∑‡∏ô</button>
  <button onclick="exportToExcel()">üìÅ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel</button>
  <button onclick="printTableOnly()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß</button>
</div>

<script>
function formatNumber(value) {
  const num = parseFloat((value || '').toString().replace(/[^\d.-]/g, '').replace(/,/g, ''));
  if (isNaN(num) || num === 0) return '';
  return num.toLocaleString('en-US', {
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  });
}

function parseCleanNumber(val) {
  return parseFloat((val || '').toString().replace(/[^\d.-]/g, '').replace(/,/g, '')) || 0;
}

function addRow(data = {}) {
  const tbody = document.getElementById("expenseBody");
  const tr = document.createElement("tr");
  const fields = ["date", "province", "unit", "purpose", "distance", "travel", "stay", "daily", "entertain", "repair", "other", "note"];

  fields.forEach(field => {
    const td = document.createElement("td");
    const input = document.createElement("input");
    input.name = field;
    input.type = "text";
    input.value = data[field] || "";

    // üîΩ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: ‡∏°‡∏µ datalist, ‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å, ‡πÄ‡∏õ‡∏¥‡∏î dropdown ‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
    if (field === "province") {
      input.setAttribute("list", "provinceList");
      input.setAttribute("autocomplete", "off");

      input.addEventListener("pointerdown", (e) => {
        if (document.activeElement === input) {
          e.preventDefault();
          input.blur();
          input.value = ""; // ‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
          setTimeout(() => input.focus(), 0);
          
        }
      });
    }

    // üîí ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    if (field === "travel") {
      input.readOnly = true;
    }
 if (["distance", "stay", "daily", "entertain", "repair", "other"].includes(field)) {
    input.style.textAlign = "right";
    input.addEventListener("blur", () => {
      input.value = formatNumber(input.value);
    });
  }
    // üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ‡πÉ‡∏ä‡πâ Flatpickr (dd/mm/yyyy)
    if (field === "date") {
      input.placeholder = "‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ";
      setTimeout(() => {
        flatpickr(input, {
          dateFormat: "d/m/Y",
          locale: {
            firstDayOfWeek: 1,
            weekdays: {
              shorthand: ['‡∏≠‡∏≤', '‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'],
              longhand: ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå']
            },
            months: {
              shorthand: ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'],
              longhand: ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                         '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°']
            }
          }
        });
      }, 0);
    }

    input.addEventListener("input", updateSummary);
    td.appendChild(input);
    tr.appendChild(td);
  });

  // üóë ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß
  const tdDel = document.createElement("td");
  const btnDel = document.createElement("button");
  btnDel.textContent = "üóë";
  btnDel.onclick = () => {
    tr.remove();
    updateSummary();
  };
  tdDel.appendChild(btnDel);
  tr.appendChild(tdDel);

  tbody.appendChild(tr);
  updateSummary();
}




function updateSummary() {
  let distanceSum = 0, travel = 0, stay = 0, daily = 0, entertain = 0, repair = 0, other = 0;
  document.querySelectorAll("#expenseBody tr").forEach(tr => {
    const tds = tr.querySelectorAll("td input");
    const distance = parseCleanNumber(tds[4].value);
    const valStay = parseCleanNumber(tds[6].value);
    const valDaily = parseCleanNumber(tds[7].value);
    const valEntertain = parseCleanNumber(tds[8].value);
    const valRepair = parseCleanNumber(tds[9].value);
    const valOther = parseCleanNumber(tds[10].value);

    const travelCost = distance * 5;
    tds[5].value = formatNumber(travelCost);

    distanceSum += distance;
    travel += travelCost;
    stay += valStay;
    daily += valDaily;
    entertain += valEntertain;
    repair += valRepair;
    other += valOther;
  });

  const advInput = document.getElementById("advanceInput");
  advInput.removeAttribute("readonly"); // üëà ensure editable
  const adv = parseCleanNumber(advInput.value);
  advInput.value = formatNumber(adv);

  const net = travel + stay + daily + entertain + repair + other - adv;

  document.getElementById("sumDistance").textContent = formatNumber(distanceSum) + ' ‡∏Å‡∏°.';
  document.getElementById("sumTravel").textContent = formatNumber(travel) + ' ‡∏ö‡∏≤‡∏ó';
  document.getElementById("sumStay").textContent = formatNumber(stay) + ' ‡∏ö‡∏≤‡∏ó';
  document.getElementById("sumDaily").textContent = formatNumber(daily) + ' ‡∏ö‡∏≤‡∏ó';
  document.getElementById("sumEntertain").textContent = formatNumber(entertain) + ' ‡∏ö‡∏≤‡∏ó';
  document.getElementById("sumRepair").textContent = formatNumber(repair) + ' ‡∏ö‡∏≤‡∏ó';
  document.getElementById("sumOther").textContent = formatNumber(other) + ' ‡∏ö‡∏≤‡∏ó';
  const netLabel = net < 0 ? "‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" : "‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°";
const netValue = formatNumber(Math.abs(net)); // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ö‡∏ß‡∏Å
document.getElementById("netTotal").textContent = `${netLabel}: ${netValue} ‡∏ö‡∏≤‡∏ó`;
}

function saveLocalNamed() {
  const name = document.getElementById("saveName").value.trim();
  if (!name) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");

  const rows = [];
  document.querySelectorAll("#expenseBody tr").forEach(tr => {
    const inputs = tr.querySelectorAll("input");
    const row = {};
    inputs.forEach(input => row[input.name] = input.value);
    rows.push(row);
  });

  const dataToSave = {
    userName: document.getElementById("userName").value,
    userPosition: document.getElementById("userPosition").value,
    fromDate: document.getElementById("fromDate").value,
    toDate: document.getElementById("toDate").value,
    advance: document.getElementById("advanceInput").value,
    rows: rows
  };

  localStorage.setItem("expense_" + name, JSON.stringify(dataToSave));
  updateSavedList();
  alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠ \"" + name + "\" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
}


function loadLocalNamed() {
  const name = document.getElementById("savedList").value;
  if (!name) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î");

  const data = JSON.parse(localStorage.getItem("expense_" + name));
  if (!data) return alert("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å");

  // ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß
  document.getElementById("userName").value = data.userName || "";
  document.getElementById("userPosition").value = data.userPosition || "";
  document.getElementById("fromDate").value = data.fromDate || "";
  document.getElementById("toDate").value = data.toDate || "";
  document.getElementById("advanceInput").value = data.advance || "0";

  // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
  document.getElementById("expenseBody").innerHTML = "";
  (data.rows || []).forEach(row => addRow(row));
  updateSummary();

  alert("üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• \"" + name + "\" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

function updateSavedList() {
  const sel = document.getElementById("savedList");
  sel.innerHTML = "";
  Object.keys(localStorage).forEach(key => {
    if (key.startsWith("expense_")) {
      const name = key.replace("expense_", "");
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      sel.appendChild(opt);
    }
  });
}

function exportToExcel() {
  const wb = XLSX.utils.book_new();
  const ws_data = [
    ["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå", "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á", "‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á", "‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å", "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á", "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á", "‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ã‡πà‡∏≠‡∏°", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ", "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"]
  ];
  document.querySelectorAll("#expenseBody tr").forEach(tr => {
    const row = [];
    tr.querySelectorAll("input").forEach(input => row.push(input.value));
    ws_data.push(row);
  });
  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  XLSX.utils.book_append_sheet(wb, ws, "‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢");
  XLSX.writeFile(wb, "expense_form.xlsx");
}

function printTableOnly() {
  const w = window.open('', '', 'width=1024,height=768');
  const name = document.getElementById("userName").value || "-";
  const position = document.getElementById("userPosition").value || "-";
  const fromDate = document.getElementById("fromDate").value || "-";
  const toDate = document.getElementById("toDate").value || "-";
  const advanceRaw = document.getElementById("advanceInput").value || "0";
  const advance = formatNumber(parseFloat(advanceRaw.replace(/,/g, '')) || 0);

  const sumDistance = document.getElementById("sumDistance").textContent;
  const sumTravel = document.getElementById("sumTravel").textContent;
  const sumStay = document.getElementById("sumStay").textContent;
  const sumDaily = document.getElementById("sumDaily").textContent;
  const sumEntertain = document.getElementById("sumEntertain").textContent;
  const sumRepair = document.getElementById("sumRepair").textContent;
  const sumOther = document.getElementById("sumOther").textContent;

  const net = (
    parseCleanNumber(sumTravel) +
    parseCleanNumber(sumStay) +
    parseCleanNumber(sumDaily) +
    parseCleanNumber(sumEntertain) +
    parseCleanNumber(sumRepair) +
    parseCleanNumber(sumOther)
  ) - parseCleanNumber(advance);

  const netLabel = net < 0 ? "‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" : "‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°";
  const netValue = formatNumber(Math.abs(net));

  const today = new Date().toLocaleDateString("th-TH", {
    day: "numeric", month: "long", year: "numeric"
  });

  let html = `
  <html><head>
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</title>
    <style>
      @page { size: landscape; margin: 10mm; }
      body { font-family: 'TH SarabunPSK', sans-serif; font-size: 16pt; }
      table { width: 100%; border-collapse: collapse; margin-top: 10px; }
      th, td { border: 1px solid black; padding: 6px; text-align: center; }
      .header-line { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 10px; }
      .footer-summary td { font-weight: bold; background: #e3f2fd; }
      tbody tr:nth-child(odd) { background-color: #f9f9f9; }
      tbody tr:nth-child(even) { background-color: #dad9f0; }
    </style>
  </head><body>
    <h2 style="text-align:center">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h2>
    <div class="header-line">
      <div>
        ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å: ${name} &nbsp;&nbsp;&nbsp;&nbsp; ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${position}
      </div>
      <div>
        ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${fromDate} ‡∏ñ‡∏∂‡∏á ${toDate}
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th><th>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</th>
          <th>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</th><th>‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</th>
          <th>‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</th><th>‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ã‡πà‡∏≠‡∏°</th><th>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        </tr>
      </thead>
      <tbody>`;

  document.querySelectorAll("#expenseBody tr").forEach(tr => {
    html += '<tr>';
    tr.querySelectorAll("td input").forEach(input => {
      let val = input.value;
      if (val === "0" || val === "0.00") val = "";
      html += `<td>${val}</td>`;
    });
    html += '</tr>';
  });

  html += `
    <tr class="footer-summary">
      <td colspan="4">‡∏£‡∏ß‡∏°</td>
      <td>${sumDistance}</td>
      <td>${sumTravel}</td>
      <td>${sumStay}</td>
      <td>${sumDaily}</td>
      <td>${sumEntertain}</td>
      <td>${sumRepair}</td>
      <td>${sumOther}</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="12" style="text-align:right; font-weight:bold;">
        ADVANCE: ${advance} ‡∏ö‡∏≤‡∏ó
      </td>
    </tr>
    <tr>
      <td colspan="12" style="text-align:right; font-weight:bold;">
        ${netLabel}: ${netValue} ‡∏ö‡∏≤‡∏ó
      </td>
    </tr>
    </tbody></table>

    <br><br>
    <table style="width: 100%; border: none; margin-top: 40px; font-size: 16pt;">
      <tr>
        <td style="width: 50%; vertical-align: top;">
          <div style="display: flex; justify-content: space-between;">
            <strong>‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å :</strong>
            <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà :</strong>${today}</div>
          </div><br>
          (<span>${name}</span>)<br>
          ${position}
        </td>
        <td style="width: 50%; vertical-align: top;">
          <div style="display: flex; justify-content: space-between;">
            <strong>‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ :</strong>
            <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà :</strong>${today}</div>
          </div><br>
          (<span>.............................................</span>)<br>
          ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
        </td>
      </tr>
    </table>
  </body></html>`;

  w.document.write(html);
  w.document.title = "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢";
  w.document.close();
  w.focus();
  w.print();
  w.close();
}



document.addEventListener("DOMContentLoaded", () => {
  updateSavedList();
  addRow();
});


</script>

<script>
    const thaiLocale = {
      firstDayOfWeek: 1,
      weekdays: {
        shorthand: ['‡∏≠‡∏≤', '‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'],
        longhand: ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'],
      },
      months: {
        shorthand: ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'],
        longhand: ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'],
      }
    };

    flatpickr("#fromDate", {
      dateFormat: "d/m/Y",
      locale: thaiLocale
    });

    flatpickr("#toDate", {
      dateFormat: "d/m/Y",
      locale: thaiLocale
    });
    const today = new Date().toLocaleDateString("th-TH", {
  day: "numeric",
  month: "long",
  year: "numeric"
});
  </script>


</body>
</html>